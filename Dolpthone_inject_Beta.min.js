function subscribe(){if(mainalert("Trying to subscribe."),subsound.load(),subsound.volume=.2,document.querySelector("#modal-inner-iframe")){let e=new MutationObserver(t=>{libalert("InnerIframeObserver","Successfully detected. {Attributes:0}"),setTimeout(()=>{e.disconnect(),subsound.play()},800)});e.observe(document.querySelector("#modal-inner-iframe"),{attributes:!0})}else{let e=new MutationObserver(e=>{let t=new MutationObserver(e=>{libalert("InnerIframeObserver","Successfully detected. {Attributes:1}"),setTimeout(()=>{t.disconnect(),subsound.play()},800)});libalert("AppModalObserver","Successfully detected."),t.observe(document.querySelector('iframe[title="教材"]'),{attributes:!0})});e.observe(document.querySelector("div.ReactModalPortal"),{childList:!0})}}function styleChecker(){let e=setInterval(()=>{window.top.document.querySelector("iframe")||location.reload();let e=window.top.document.querySelector("iframe").contentDocument;e.querySelector("link#renewedStyle")||styleApply(e);let t=Array.from(e.querySelectorAll("iframe"));t&&t.forEach(e=>{e.contentDocument.querySelector("link#renewedStyle")||styleApply(e.contentDocument)})},1e3);return libalert("StyleChecker",`Process started and observing nodes. id: ${e}`),styleProcs.push(e),e}function styleApply(e){let t=document.createElement("link");t.rel="stylesheet",t.href=dolphoneCSS,t.id="renewedStyle",e.head.appendChild(t)}function videochecker(e){setTimeout(()=>{let t=document.querySelector("ul[aria-label=必修教材リスト]>li:has(.zixPn)");if(t=t.querySelector(":has(i[type='movie-rounded'])")?"movie":t.innerHTML.includes("記述/選択")?"evaluation-test":t.innerHTML.includes("論述")?"essay-test":"unknown",libalert("SelectedTypeDetecter",'Selected Item Type is: "'+t+'".'),"movie"==t){let t=setInterval(()=>{let e=window.top.document.querySelector("iframe[title='教材']").contentDocument.querySelector("#video-player");e.duration<=e.currentTime&&(done(),libalertimportant("VideoDurationChecker","process ended."),clearInterval(t))},200);setTimeout(()=>{let e=window.top.document.querySelector("iframe").contentDocument.querySelector("#video-player");e.paused&&e.play()},5e3),libalertimportant("VideoDurationChecker","process started. by process "+e)}},100)}function done(){mainalert("Content ended."),setTimeout(()=>{next()},1e3);let e=setTimeout(()=>{reinject(),mainalert("Subscribe"),clearTimeout(e)},1e4)}function next(){mainalert("Trying to access next content."),document.querySelector('div[aria-label="教材フィルタ"]').querySelectorAll(".khUwkq")&&(document.querySelector('button[aria-label="必修教材のみ"]').classList.contains("ixzVeN")||document.querySelector('button[aria-label="必修教材のみ"]').click());const e=window.top.document.querySelectorAll('[aria-label="必修教材リスト"]')[0].getElementsByTagName("li");let t=0;for(const o in e){const r=e[o].innerHTML;if(!r.includes("color: rgb(0, 197, 65);")){if(r.includes("movie-rounded")&&!r.includes("movie-rounded-plus"))break;if(r.includes("記述/選択")||r.includes("論述")){notifsound.load(),notifsound.volume=.201,notifsound.play(),notifsound.addEventListener("ended",()=>{notifsound=""});break}}t+=1}let o=0!=t?t-1:0;e[t].querySelector("div").click(),setTimeout(()=>{indicatorUpdate(),e[o].querySelector("div").scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),styleProcs.length>1&&styleProcs.forEach((e,t)=>{if(styleProcs.length>1){let e=styleProcs.pop();libalert("ProcessFixer",`Process [ ${e} ] is trashed.`),clearInterval(e)}})},3e3)}function startup(){if(!document.body.classList.contains("izialready")){let o=window.top.document.createElement("script");o.src="https://raw.githubusercontent.com/yautaenon/Dolphone/main/Dolphone/iziToast/iziToast.min.js",o.id="iziToastScript",window.top.document.querySelector("script#di").before(o);let r=document.createElement("link");r.rel="stylesheet",r.href="https://raw.githubusercontent.com/yautaenon/Dolphone/main/Dolphone/iziToast/iziToast.min.css",r.id="iziToastStyle",window.top.document.head.appendChild(r);let n=document.createElement("link");n.rel="stylesheet",n.href=dolphoneIndicator,n.id="indicatorStyle",window.top.document.head.appendChild(n);let l=document.createElement("link");l.rel="stylesheet",l.href=dolphoneCSS,l.id="renewedStyle",window.top.document.head.appendChild(l),document.body.classList.add("izialready"),patchsound.load(),patchsound.volume=.2,setTimeout(()=>{patchsound.play(),window.top.veralart(e,window_5209hbf298hew9jfiowg_Dolpthone_patch,t),window.top.indicatorsetup()},1e3)}let e=window_5209hbf298hew9jfiowg_Dolpthone_version,t="reinjected"==document.querySelector("script#di").className?"re":"";"re"==t&&mainalert("reinjected.")}function calculateFontColor(e){const t={red:parseInt(e.substr(0,2),16),green:parseInt(e.substr(2,2),16),blue:parseInt(e.substr(4,2),16)},o=e=>{const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)},r=e=>{const{red:t,green:r,blue:n}=e;let l=o(t),i=o(r),c=o(n);return.2126*l+.7152*i+.0722*c},n=(e,t)=>{const o=r(e),n=r(t),l=Math.max(o,n),i=Math.min(o,n);return(l+.05)/(i+.05)},l=e=>{const t={red:0,green:0,blue:0},o={red:255,green:255,blue:255},r=n(e,o),l=n(e,t);return r>l?o:t},i=({red:e,green:t,blue:o})=>[`0${Number(e).toString(16)}`.slice(-2),`0${Number(t).toString(16)}`.slice(-2),`0${Number(o).toString(16)}`.slice(-2)].join(""),c=l(t);return i(c)}function calculateAverageColor(e,t){e=[parseInt(e.substr(0,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(4,2),16)],t=[parseInt(t.substr(0,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(4,2),16)];let o=[];for(let r=0;r<3;r++)o.push(Number(Math.round((e[r]+t[r])/2)).toString(16).padStart(2,"0"));return o.join("")}function veralart(e,t,o){let r=`version ${e}-%c${t.substr(0,3)}%c${t.substr(3,1)}%c${t.substr(4,3)}%c has ${o}applied.`,n=(t.substr(0,3),t.substr(3,1),t.substr(4,3),[t.substr(0,6),t.substr(1,6)]);n.push(calculateAverageColor(n[0],n[1]));let l=[calculateFontColor(n[0]),calculateFontColor(n[1]),calculateFontColor(n[2])];console.debug("%cDolphone%c "+r,"color:#000;background-image:linear-gradient(90deg,#00c541,#4f73e3,#e3734f);padding:2px 4px;border-radius:4px;","",`color:#${l[0]};background-color:#${n[0]};padding:2px 0 2px 4px;border-radius:10px 0 0 10px;`,`color: #${l[2]})};background-image: linear-gradient(90deg,#${n[0]},#${n[2]},#${n[1]});padding: 2px 0 2px 0;`,`color:#${l[1]};background-color:#${n[1]};padding:2px 4px 2px 0;border-radius:0 10px 10px 0;`,"")}function libalert(e,t){console.debug("%cDolphoneLib - "+e+"%c "+t,"color:#000;background-color:#4f73e3;padding:2px 4px;border-radius:4px;","")}function libalertimportant(e,t){console.debug("%cDolphoneLib - "+e+"%c "+t,"color:#000;background-color:#e3734f;padding:2px 4px;border-radius:4px;","")}function mainalert(e){console.debug("%cDolphone%c "+e,"color:#000;background-color:#00c541;padding:2px 4px;border-radius:4px;","")}function reinject(){let e=document.querySelector("script#di");null!=e&&document.querySelector("script#di").remove();let t=document.createElement("script");t.src=dolphoneJS,t.id="di",t.className="reinjected",window.top.document.head.appendChild(t)}function indicatorsetup(){setTimeout(()=>{let e=setInterval(()=>{let e=document.querySelectorAll("ul[aria-label='必修教材リスト']>li"),t=null;document.querySelector('div[aria-label="教材フィルタ"]').querySelectorAll(".khUwkq")&&(document.querySelector('button[aria-label="必修教材のみ"]').classList.contains("ixzVeN")||document.querySelector('button[aria-label="必修教材のみ"]').click()),[...e].forEach(e=>{e.querySelector('i[type="movie-rounded"]')&&e.classList.add("movie"),e.querySelector("div.iFkSEV")&&(e.innerHTML.includes("記述/選択")?e.classList.add("evaluation-test"):e.innerHTML.includes("論述")&&e.classList.add("essay-test")),e.querySelector("i[style*='color: rgb(0, 197, 65);']")&&e.classList.add("good")});for(let o=0;o<e.length;o++){let r=e[o].classList;r.contains("movie")&&e[o].querySelector("div.zixPn")&&(t=o)}if(null!==t){t=e[t],movieel=document.querySelector("iframe").contentDocument.querySelector("video");let o=Math.round(movieel.currentTime/movieel.duration*1e3)/10;t.querySelector("svg>circle:nth-of-type(2)")&&t.querySelector("svg>circle:nth-of-type(2)").setAttribute("stroke-dashoffset",100-o),t.style.setProperty("--movie-progress",`${o}%`)}},20);libalert("Indicator",`Process started; id: ${e}`)},1e4)}function indicatorUpdate(){let e=document.querySelectorAll("ul[aria-label='必修教材リスト']>li");document.querySelector('div[aria-label="教材フィルタ"]').querySelectorAll(".khUwkq")&&(document.querySelector('button[aria-label="必修教材のみ"]').classList.contains("ixzVeN")||document.querySelector('button[aria-label="必修教材のみ"]').click());for(let t=0;t<e.length;t++){let o=e[t].classList;if(o.contains("movie"))libalert("IndicatorUpdator",`Item [${t}] is "movie"`),o.contains("good")&&libalert("IndicatorUpdator",`Item [${t}] is "movie-good"`);else if((o.contains("evaluation-test")||o.contains("essay-test"))&&(libalert("IndicatorUpdator",`Item [${t}] is "test"`),o.contains("good")&&libalert("IndicatorUpdator",`Item [${t}] is "test-good"`),e[t].querySelector("div.zixPn"))){libalert("IndicatorUpdator",`Item [${t}] is "test-progress"`),e[t].classList.add("now"),alertsound.load(),alertsound.loop=!0,alertsound.volume=.2,alertsound.play();let o=setInterval(()=>{alertsound.volume=.2},1e3);finishChecker(t,o,alertsound)}}setTimeout(videochecker(2),2e3),libalert("Indicator","Indicator Updated.")}function finishChecker(e,t,o){let r=document.createElement("link");r.rel="stylesheet",r.href=dolphoneCSS,r.id="renewedStyle",window.top.document.querySelector("iframe[title='教材']").contentDocument.head.appendChild(r);let n=document.querySelectorAll("ul[aria-label='必修教材リスト']>li")[e],l=setInterval(()=>{n.querySelector("i[style*='color: rgb(0, 197, 65);']")&&(clearInterval(t),clearInterval(l),libalert("TestCorrectChecker","process ended."),n.classList.contains("now")&&n.classList.remove("now"),o.loop=!1,setTimeout(()=>{done()},5e3))},500);libalert("TestCorrectChecker","process started.")}var window_b9012ye1by98ryn98dy1_Dolpthone_BranchID,dolphoneJS,dolphoneCSS,dolphoneIndicator;window_5209hbf298hew9jfiowg_Dolpthone_version="1.1.0";var styleProcs=[];$.getJSON("https://script.google.com/macros/s/AKfycbyQVJL5Uj3pqJLGSGJTctONz4OIN5xVi_1DLFOy8Qe-n4nt8dSq84laKWZf3Ey4iUKM/exec?id="+ProductKey,e=>{function t(){startup(),setTimeout(()=>{subscribe(),styleChecker(),document.querySelector("iframe")||next()},1e3),document.body.removeEventListener("click",t,!1)}dolphoneJS=e.url,dolphoneCSS=e.css,dolphoneIndicator=e.indicator,window_5209hbf298hew9jfiowg_Dolpthone_patch=e.version,window_ony98gvayn9fj8hg98ha_Dolpthone_versionType="_Beta",subsound=new Audio("https://raw.githubusercontent.com/yautaenon/Dolphone/main/Dolphone/003_1s.wav"),notifsound=new Audio("https://raw.githubusercontent.com/yautaenon/Dolphone/main/Dolphone/002_3s.wav"),patchsound=new Audio("https://raw.githubusercontent.com/yautaenon/Dolphone/main/Dolphone/001_2s.wav"),alertsound=new Audio("https://raw.githubusercontent.com/yautaenon/Dolphone/main/Dolphone/alert_2315_002.wav"),document.body.addEventListener("click",t,!1)});